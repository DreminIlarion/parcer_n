
<nav aria-label="Page navigation example" class='mt-4'>
    <ul class="pagination justify-content-center">

        {% if 'csrfmiddlewaretoken' in request.get_full_path %}
            {% if page_obj.has_previous %}
            <li class='page-item me-2' ><a class='page-link' href="{{ request.get_full_path }}&page={{ page_obj.previous_page_number }}">&laquo;</a></li>

            {% if page_obj.number > 3 %}
                <li class='page-item' ><a class='page-link' href="{{ request.get_full_path }}&page=1">1</a></li>
                {% if page_obj.number > 4 %}
                <li class='page-item' ><a class='page-link' >...</a></li>
                {% endif %}
            {% endif %}
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class='page-item' ><a class='page-link' href="{{ request.get_full_path }}&page={{ num }}">{{ num }}</a></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class='page-item' ><a class='page-link' href="{{ request.get_full_path }}&page={{ num }}">{{ num }}</a></li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
                <li class='page-item' ><a class='page-link' >...</a></li>
                <li class='page-item' ><a class='page-link' href="{{ request.get_full_path }}&page={{ page_obj.paginator.num_pages }}">
                {{ page_obj.paginator.num_pages }}
                </a></li>
            {% elif page_obj.number < page_obj.paginator.num_pages|add:'-2' %}
                <li class='page-item' ><a class='page-link' href="{{ request.get_full_path }}&page={{ page_obj.paginator.num_pages }}">
                {{ page_obj.paginator.num_pages }}
                </a></li>
            {% endif %}

            <li class='page-item ms-2' ><a class='page-link' href="{{ request.get_full_path }}&page={{ page_obj.next_page_number }}">&raquo;</a></li>
            {% endif %}

        {% else %}        
            {% if page_obj.has_previous %}
            <li class='page-item me-2' ><a class='page-link' href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>

            {% if page_obj.number > 3 %}
                <li class='page-item' ><a class='page-link' href="?page=1">1</a></li>
                {% if page_obj.number > 4 %}
                <li class='page-item' ><a class='page-link' >...</a></li>
                {% endif %}
            {% endif %}
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <li class='page-item' ><a class='page-link' href="?page={{ num }}">{{ num }}</a></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class='page-item' ><a class='page-link' href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
                <li class='page-item' ><a class='page-link' >...</a></li>
                <li class='page-item' ><a class='page-link' href="?page={{ page_obj.paginator.num_pages }}">
                {{ page_obj.paginator.num_pages }}
                </a></li>
            {% elif page_obj.number < page_obj.paginator.num_pages|add:'-2' %}
                <li class='page-item' ><a class='page-link' href="?page={{ page_obj.paginator.num_pages }}">
                {{ page_obj.paginator.num_pages }}
                </a></li>
            {% endif %}

            <li class='page-item ms-2' ><a class='page-link' href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
            {% endif %}
        {% endif %}         
    </ul>
</nav>